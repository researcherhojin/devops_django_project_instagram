<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        {% load static %}

        <title>Instagram Clone</title>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <!-- êµ¬ê¸€ ì•„ì´ì½˜ (Material Symbols) -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
        <!-- Jquery -->
        <script src="https://code.jquery.com/jquery-latest.min.js"></script>

        <style>
            /****************************************
      * Global Reset & Basic Setup
      ****************************************/
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            html,
            body {
                width: 100%;
                height: 100%;
                /* ë¶ˆí•„ìš”í•œ ìˆ˜í‰ ìŠ¤í¬ë¡¤ ë°©ì§€ */
                overflow-x: hidden;
            }
            body {
                background-color: #fff; /* Instagram-like background (í°ìƒ‰) */
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
                color: #262626;
            }

            /****************************************
      * Left Navigation (fixed sidebar)
      ****************************************/
            .nav-left {
                position: fixed;
                top: 0;
                left: 0;
                width: 250px; /* ì™¼ìª½ ì‚¬ì´ë“œë°” í­ */
                height: 100vh;
                border-right: 1px solid #dbdbdb;
                background-color: #fff;
                z-index: 999;
                padding: 20px 12px;
                display: flex;
                flex-direction: column;
            }
            .nav-logo {
                margin-bottom: 1.5rem;
                padding-left: 8px;
            }
            .nav-logo img {
                width: 103px;
                height: auto;
            }
            .nav-menu {
                display: flex;
                flex-direction: column;
                gap: 8px;
                margin-bottom: auto;
            }
            .nav-item {
                display: flex;
                align-items: center;
                padding: 10px 12px;
                gap: 14px;
                border-radius: 8px;
                color: #000;
                text-decoration: none;
                font-size: 15px;
            }
            .nav-item:hover {
                background-color: #f8f8f8;
            }
            .nav-item span.material-symbols-outlined {
                font-size: 24px;
            }
            .nav-bottom {
                margin-top: 12px;
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            /****************************************
      * Main Wrapper (center + right)
      ****************************************/
            .main-wrapper {
                margin-left: 250px; /* ì‚¬ì´ë“œë°” í­ë§Œí¼ ì™¼ìª½ ì—¬ë°± */
                width: calc(100% - 250px);
                min-height: 100vh;
                padding: 30px 20px;
                display: flex;
                gap: 32px;
            }

            /****************************************
      * Center Content (Feed)
      ****************************************/
            .content {
                max-width: 600px;
                width: 100%;
            }

            /* Stories */
            .stories {
                background-color: #fff;
                border: 1px solid #dbdbdb;
                border-radius: 8px;
                margin-bottom: 24px;
                padding: 16px 0;
            }
            .stories-list {
                display: flex;
                gap: 16px;
                padding: 0 16px;
                overflow-x: auto;
                scrollbar-width: none;
            }
            .stories-list::-webkit-scrollbar {
                display: none;
            }
            .story {
                display: flex;
                flex-direction: column;
                align-items: center;
                cursor: pointer;
            }
            .story-ring {
                width: 66px;
                height: 66px;
                border-radius: 50%;
                padding: 3px;
                background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
                margin-bottom: 6px;
            }
            .story-photo {
                width: 60px;
                height: 60px;
                border-radius: 50%;
                border: 2px solid #fff;
                object-fit: cover;
            }
            .story-username {
                font-size: 12px;
                width: 66px;
                text-align: center;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            /* Post (feed) */
            .post {
                background-color: #fff;
                border: 1px solid #dbdbdb;
                border-radius: 8px;
                margin-bottom: 24px;
            }
            .post-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 14px 16px;
            }
            .post-user {
                display: flex;
                align-items: center;
                gap: 12px;
            }
            .post-avatar {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                object-fit: cover;
            }
            .post-username {
                font-weight: 600;
                font-size: 14px;
            }
            .post-more {
                background: none;
                border: none;
                cursor: pointer;
            }
            .post-img-container {
                width: 100%;
                background: #000; /* ì´ë¯¸ì§€ ë¡œë”© ì „ ë°°ê²½ìƒ‰ */
            }
            .post-image {
                width: 100%;
                display: block;
                object-fit: cover;
            }
            .post-actions {
                padding: 8px 16px;
            }
            .post-buttons {
                display: flex;
                justify-content: space-between;
            }
            .buttons-left {
                display: flex;
                gap: 16px;
            }
            .action-button {
                background: none;
                border: none;
                padding: 6px 0;
                cursor: pointer;
            }
            .action-button span {
                font-size: 24px;
                color: #262626;
            }
            .post-caption {
                padding: 0 16px 12px;
                font-size: 14px;
                line-height: 1.4;
            }
            .post-caption .username {
                font-weight: 600;
                margin-right: 6px;
            }
            .post-caption .more {
                color: #8e8e8e;
                font-size: 12px;
                cursor: pointer;
            }
            .like-section {
                display: flex;
                align-items: center;
                gap: 4px;
            }
            .like-count {
                font-size: 14px;
                font-weight: 600;
            }

            /****************************************
      * Right Sidebar
      ****************************************/
            .sidebar {
                width: 320px;
                flex-shrink: 0;
                display: flex;
                flex-direction: column;
                margin-top: 16px;
            }
            .user-info {
                display: flex;
                align-items: center;
                margin-bottom: 16px;
            }
            .user-avatar {
                width: 56px;
                height: 56px;
                border-radius: 50%;
                margin-right: 12px;
                object-fit: cover;
            }
            .user-name {
                font-weight: 600;
                font-size: 14px;
            }
            .user-subtitle {
                font-size: 14px;
                color: #8e8e8e;
            }

            .suggestions {
                margin-bottom: 16px;
            }
            .suggestions-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
                padding: 0 8px;
            }
            .suggestions-title {
                font-size: 14px;
                color: #8e8e8e;
                font-weight: 600;
            }
            .see-all {
                font-size: 12px;
                font-weight: 600;
                color: #262626;
                text-decoration: none;
            }
            .suggestion-item {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 8px;
            }
            .suggestion-user {
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .suggestion-avatar {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                object-fit: cover;
            }
            .suggestion-info {
                font-size: 12px;
            }
            .suggestion-username {
                font-weight: 600;
            }
            .suggestion-meta {
                color: #8e8e8e;
            }
            .follow-button {
                background: none;
                border: none;
                color: #0095f6;
                font-weight: 600;
                font-size: 12px;
                cursor: pointer;
            }

            .footer {
                margin-top: 16px;
                font-size: 12px;
                color: #c7c7c7;
                line-height: 1.6;
            }
            .footer a {
                color: #c7c7c7;
                text-decoration: none;
            }

            /****************************************
      * Responsive
      ****************************************/
            @media (max-width: 1100px) {
                /* ìš°ì¸¡ ì‚¬ì´ë“œë°” ìˆ¨ê¸°ê¸°(í•„ìš” ì‹œ) */
                .sidebar {
                    display: none;
                }
                .main-wrapper {
                    margin-left: 250px;
                    width: calc(100% - 250px);
                }
            }
            @media (max-width: 768px) {
                /* ëª¨ë°”ì¼ì—ì„œ ì¢Œì¸¡ ë©”ë‰´ ìˆ¨ê¸°ê¸° â†’ ì „ì²´ í­ ì‚¬ìš© */
                .nav-left {
                    display: none;
                }
                .main-wrapper {
                    margin-left: 0;
                    width: 100%;
                    gap: 0;
                    padding: 16px;
                }
                .content {
                    max-width: 100%;
                }
            }

            /****************************************
      * modal style setting
      ****************************************/
            .modal_overlay {
                width: 100%;
                height: 100%;
                position: fixed;
                left: 0;
                top: 0;
                display: none; /* ìµœì´ˆì—ëŠ” ìˆ¨ê¹€ */
                flex-direction: column;
                align-items: center;
                justify-content: center;
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(1.5px);
                -webkit-backdrop-filter: blur(1.5px);
                z-index: 9999; /* ë‹¤ë¥¸ ìš”ì†Œë“¤ë³´ë‹¤ ë†’ì€ ê°’ìœ¼ë¡œ ì„¤ì • */
            }

            .modal_window {
                background: white;
                backdrop-filter: blur(13.5px);
                -webkit-backdrop-filter: blur(13.5px);
                border-radius: 10px;
                border: 1px solid rgba(255, 255, 255, 0.18);
                width: 800px;
                height: 600px;
                position: relative;
                padding: 10px;
            }

            /****************************************
      * close-button
      ****************************************/
            .close-button {
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                border-radius: 50%;
                transition: background-color 0.2s;
            }

            .close-button:hover {
                background-color: #f0f0f0;
            }

            /* profile_image style */
            .box {
                width: 70px;
                height: 70px;
                border-radius: 50%;
                overflow: hidden;
                margin-right: 10px;
            }
            .profile {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            /* í”„ë¡œí•„ ë“œë¡­ë‹¤ìš´ ê´€ë ¨ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
            .dropdown {
                position: relative;
                display: inline-block;
            }

            /* ì¢‹ì•„ìš” ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
            .favorite {
                transition: all 0.2s ease;
            }
            .favorite.active {
                color: #ff3040 !important; /* Instagram ìŠ¤íƒ€ì¼ì˜ ë¹¨ê°„ìƒ‰ */
                animation: likeAnimation 0.3s ease-in-out;
            }

            /* ì¢‹ì•„ìš” ì• ë‹ˆë©”ì´ì…˜ */
            @keyframes likeAnimation {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.2);
                }
                100% {
                    transform: scale(1);
                }
            }

            /* ë¶ë§ˆí¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
            .bookmark {
                transition: all 0.2s ease;
            }
            .bookmark.active {
                color: #0095f6 !important; /* Instagram ìŠ¤íƒ€ì¼ì˜ íŒŒë€ìƒ‰ */
            }

            /* ëŒ“ê¸€ ê²Œì‹œ ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
            .upload_reply {
                cursor: pointer;
                transition: opacity 0.2s ease;
            }
            .upload_reply:hover {
                opacity: 0.7;
            }
        </style>
    </head>

    <body>
        <!-- 403 Forbidden Error Sol -->
        {% csrf_token %}

        <script>
            const csrftoken = '{{ csrf_token }}';
        </script>

        <!-- Left Navigation -->
        <nav class="nav-left">
            <!-- ì¸ìŠ¤íƒ€ê·¸ë¨ ë¡œê³  -->
            <a class="nav-logo" href="{% url 'index' %}">
                <img
                    src="https://i.namu.wiki/i/Klgx94WBnXNxrBU6vIxEOR18wYX9Xgca09FVQ5Bxik1VPkDqDz45tXJmARshWgbKUBAGQezFSeBLGeu4TqmEI04mbnlZvy-XQbMgn7Pw7F6zDPPpY2GKUAnHakNTAd-w92Ke7PM4iT761GFRSwTAHA.svg"
                    alt="Instagram"
                />
            </a>
            <div class="nav-menu">
                <a href="{% url 'home' %}" class="nav-item"> <span class="material-symbols-outlined">home</span>í™ˆ </a>
                <a href="#" class="nav-item"> <span class="material-symbols-outlined">search</span>ê²€ìƒ‰ </a>
                <a href="#" class="nav-item"> <span class="material-symbols-outlined">explore</span>íƒìƒ‰ íƒ­ </a>
                <a href="#" class="nav-item"> <span class="material-symbols-outlined">movie</span>ë¦´ìŠ¤ </a>
                <a href="#" class="nav-item"> <span class="material-symbols-outlined">send</span>ë©”ì‹œì§€ </a>
                <a href="#" class="nav-item"> <span class="material-symbols-outlined">favorite</span>ì•Œë¦¼ </a>
                <!-- add_boxì— id ê°’ ì¶”ê°€ -->
                <a href="#" id="nav_bar_add_box" class="nav-item">
                    <span class="material-symbols-outlined">add_box</span>ë§Œë“¤ê¸°
                </a>
                <a href="/content/profile" class="nav-item">
                    <span class="material-symbols-outlined">account_circle</span>í”„ë¡œí•„
                </a>
            </div>
            <div class="nav-bottom">
                <a href="#" class="nav-item"> <span class="material-symbols-outlined">message</span>Threads </a>
                <a href="#" class="nav-item"> <span class="material-symbols-outlined">menu</span>ë” ë³´ê¸° </a>
            </div>
        </nav>

        <!-- Main Wrapper -->
        <div class="main-wrapper">
            <!-- Center Content (Feed) -->
            <section class="content">
                <!-- Stories -->
                <div class="stories">
                    <div class="stories-list">
                        <!-- Story #1 -->
                        <div class="story">
                            <div class="story-ring">
                                <img
                                    src="https://pbs.twimg.com/profile_images/1874558173962481664/8HSTqIlD_400x400.jpg"
                                    alt="Story"
                                    class="story-photo"
                                />
                            </div>
                            <div class="story-username">Elon Musk</div>
                        </div>
                        <!-- Story #2 -->
                        <div class="story">
                            <div class="story-ring">
                                <img
                                    src="https://img1.daumcdn.net/thumb/C500x500/?fname=http://t1.daumcdn.net/brunch/service/user/2YH6/image/7kmtv0190Fu60wySRrrBTt_z_Tc.png"
                                    alt="Story"
                                    class="story-photo"
                                />
                            </div>
                            <div class="story-username">ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼</div>
                        </div>
                        <!-- Story #3 -->
                        <div class="story">
                            <div class="story-ring">
                                <img
                                    src="https://i.namu.wiki/i/SqFwJEfWPrWhP8QZVZ0l8GU6lu0ceGC7QOMd1Sk_RfuxAwsHjPOmInsP4N46Kz-4ErzHvqOcBWAoBcWS1153adsPU-OmKa1oFkkEHtl2Dk2u3Xk5d2qNU-2pS-fLkwxbKL_T44nQKteKle35UDrvYA.webp"
                                    alt="Story"
                                    class="story-photo"
                                />
                            </div>
                            <div class="story-username">Steve Jobs</div>
                        </div>
                        <!-- Story #4 -->
                        <div class="story">
                            <div class="story-ring">
                                <img
                                    src="https://i.namu.wiki/i/4nf3GF-ePr0_nzj9C2p6fJ5PuNSpQFG-A5zGCdsbVirTm3a54GYHpPzVhsgvSVyPsRHkOtFXjOZd1QL0bfQyinZUNZZ8dS9pwEZHQ0TNZUvyPAVn4xVrFD1rM_L9Xcq4ncHsvhKuIR2El3duO9eVwQ.webp"
                                    alt="Story"
                                    class="story-photo"
                                />
                            </div>
                            <div class="story-username">Mark Zuckerberg</div>
                        </div>
                        <!-- Story #5 -->
                        <div class="story">
                            <div class="story-ring">
                                <img
                                    src="https://i.namu.wiki/i/Fq03GpmAIEnwvlfEfYyOMkQXg1tHhXeq3i3coZFrBhLvTuo6iE5Sh-JxnOLRwhKFynT1tMBQaS0mUtBtp9tqgRBRAztMo7HJ0akB0YylD4DPOsz_FcNAFbA-9O6C1_Q_YvxoeihK-mCpGBq1x2eSdA.webp"
                                    alt="Story"
                                    class="story-photo"
                                />
                            </div>
                            <div class="story-username">Bill Gates</div>
                        </div>
                        <!-- Story #6 -->
                        <div class="story">
                            <div class="story-ring">
                                <img
                                    src="https://i.namu.wiki/i/QxM8Rf7YsztObrep3IzwBz_IUismgOTcCFI4BxMUM0YuqvnucA5lnhNCgYzThbw3QgmsUmUV4frCLMjicfvnCsDfkTmJAc1whAj1uKfnaUjxLfcjEthQa_4Xv7CZMyo07Hkj6Fn-WyH0wLJd72gAAQ.webp"
                                    alt="Story"
                                    class="story-photo"
                                />
                            </div>
                            <div class="story-username">Warren Buffett</div>
                        </div>
                        <!-- Story #7 -->
                        <div class="story">
                            <div class="story-ring">
                                <img
                                    src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRj_JdIMj8eQ3AAUqYMwLYgMX-0qnyHWnJjrg&s"
                                    alt="Story"
                                    class="story-photo"
                                />
                            </div>
                            <div class="story-username">Jude Friday</div>
                        </div>
                    </div>
                </div>

                <!-- í”¼ë“œê°€ ì—†ì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆ, feedsê°€ ë¹„ì–´ìˆì„ ê²½ìš° ì¡°ê±´ ì²˜ë¦¬ ì˜ˆì‹œ -->
                {% if feeds %} {% for feed in feeds %}
                <article class="post">
                    <div class="post-header">
                        <div class="post-user">
                            <!-- í”¼ë“œ ì£¼ì¸ì˜ í”„ë¡œí•„ ì´ë¯¸ì§€ -->
                            {% if feed.profile_image %}
                            <img
                                src="{% get_media_prefix %}{{ feed.profile_image }}"
                                alt="Avatar"
                                class="post-avatar"
                            />
                            {% else %}
                            <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ ì´ë¯¸ì§€ ì˜ˆì‹œ -->
                            <img src="{% static 'images/default_profile.png' %}" alt="Avatar" class="post-avatar" />
                            {% endif %}

                            <!-- í”¼ë“œ ì£¼ì¸ì˜ ë‹‰ë„¤ì„ -->
                            <span class="post-username"> {{ feed.nickname }} </span>
                        </div>
                        <button class="post-more">
                            <span class="material-symbols-outlined">more_horiz</span>
                        </button>
                    </div>

                    <div class="post-img-container">
                        <img src="{% get_media_prefix %}{{ feed.image }}" alt="Post" class="post-image" />
                    </div>

                    <!-- í”¼ë“œ ì•¡ì…˜ ì„¹ì…˜ -->
                    <div class="post-actions">
                        <div class="post-buttons">
                            <div class="buttons-left">
                                <!-- ì¢‹ì•„ìš” ë²„íŠ¼ -->
                                <button class="action-button">
                                    <span
                                        id="favorite_{{ feed.id }}"
                                        feed_id="{{ feed.id }}"
                                        class="favorite material-symbols-outlined {% if feed.is_liked %}active{% endif %}"
                                    >
                                        {% if feed.is_liked %}favorite{% else %}favorite_border{% endif %}
                                    </span>
                                </button>
                                <button class="action-button">
                                    <span class="material-symbols-outlined">chat_bubble_outline</span>
                                </button>
                                <button class="action-button">
                                    <span class="material-symbols-outlined">send</span>
                                </button>
                            </div>
                            <!-- ë¶ë§ˆí¬ ë²„íŠ¼ -->
                            <button class="action-button">
                                <span
                                    id="bookmark_{{ feed.id }}"
                                    feed_id="{{ feed.id }}"
                                    class="bookmark material-symbols-outlined {% if feed.is_marked %}active{% endif %}"
                                >
                                    {% if feed.is_marked %}bookmark{% else %}bookmark_border{% endif %}
                                </span>
                            </button>
                        </div>
                        <!-- ì¢‹ì•„ìš” ìˆ˜ í‘œì‹œ -->
                        <div class="like-count">
                            ì¢‹ì•„ìš”
                            <span id="like_count_{{ feed.id }}">{{ feed.like_count }}</span>ê°œ
                        </div>
                    </div>

                    <!-- ë³¸ë¬¸ -->
                    <div class="post-caption">
                        <span class="username">{{ feed.nickname }}</span>
                        {{ feed.content }}
                    </div>

                    <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
                    <div id="reply_list_{{ feed.id }}" class="post-replies">
                        {% for reply in feed.reply_list %}
                        <div class="reply-item" style="padding: 0 16px; margin-bottom: 4px; font-size: 14px">
                            <span class="username" style="font-weight: 600; margin-right: 6px"
                                >{{ reply.nickname }}</span
                            >
                            <span class="reply-content">{{ reply.reply_content }}</span>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- ëŒ“ê¸€ ì…ë ¥ì°½ -->
                    <div style="display: flex; flex-direction: row; align-items: center; border-top: solid 1px gray">
                        <input
                            id="reply_{{ feed.id }}"
                            type="text"
                            class="form-control"
                            style="box-shadow: none; border: none; outline: none"
                            placeholder="ëŒ“ê¸€ ë‹¬ê¸°.."
                        />
                        <div
                            feed_id="{{ feed.id }}"
                            class="upload_reply"
                            style="width: 50px; color: cornflowerblue; font-weight: bold; text-align: center"
                        >
                            ê²Œì‹œ
                        </div>
                    </div>
                </article>
                {% endfor %} {% else %}
                <p>ì•„ì§ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ê²Œì‹œë¬¼ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                {% endif %}
            </section>

            <!-- Right Sidebar -->
            <aside class="sidebar d-none d-xl-flex flex-column">
                <!-- ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ í”„ë¡œí•„ í‘œì‹œ -->
                {% if user.is_authenticated %}
                <div class="user-info d-flex align-items-center">
                    <!-- User profile section (ë“œë¡­ë‹¤ìš´)-->
                    <div class="dropdown">
                        <div
                            class="box"
                            role="button"
                            id="profileDropdown"
                            data-bs-toggle="dropdown"
                            aria-expanded="false"
                        >
                            <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ì´ë¯¸ì§€ë¡œ ëŒ€ì²´ -->
                            {% if user.profile_image %}
                            <img
                                class="profile"
                                src="{% get_media_prefix %}{{ user.profile_image }}"
                                alt="í”„ë¡œí•„ ì´ë¯¸ì§€"
                            />
                            {% else %}
                            <img class="profile" src="{% static 'images/default_profile.png' %}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" />
                            {% endif %}
                        </div>

                        <!-- ë“œë¡­ë‹¤ìš´ ë©”ë‰´ -->
                        <ul class="dropdown-menu" aria-labelledby="profileDropdown">
                            <li>
                                <a class="dropdown-item" href="/content/profile">í”„ë¡œí•„</a>
                            </li>
                            <li><hr class="dropdown-divider" /></li>
                            <li>
                                <a class="dropdown-item" href="/user/logout">ë¡œê·¸ì•„ì›ƒ</a>
                            </li>
                        </ul>
                    </div>

                    <!-- ì‚¬ìš©ì ì •ë³´ -->
                    <div style="margin-left: 10px; text-align: left">
                        <!-- ë‹‰ë„¤ì„, ì´ë¦„(ë˜ëŠ” username) -->
                        <div style="font-weight: bold">{{ user.nickname|default:user.username }}</div>
                        <div style="color: gray">{{ user.name|default:"ë¡œê·¸ì¸í•œ ìœ ì €" }}</div>
                    </div>
                </div>
                {% else %}
                <!-- ë¯¸ë¡œê·¸ì¸ ìƒíƒœë¼ë©´ ë¡œê·¸ì¸/íšŒì›ê°€ì… ë§í¬ ë“±ì„ ì œê³µí•  ìˆ˜ë„ ìˆìŒ -->
                <div>
                    <a href="{% url 'login' %}">ë¡œê·¸ì¸</a> /
                    <a href="{% url 'signup' %}">íšŒì›ê°€ì…</a>
                </div>
                {% endif %}

                <div class="suggestions">
                    <div class="suggestions-header">
                        <span class="suggestions-title">íšŒì›ë‹˜ì„ ìœ„í•œ ì¶”ì²œ</span>
                        <a href="#" class="see-all">ëª¨ë‘ ë³´ê¸°</a>
                    </div>
                    <!-- ë‚˜ë¨¸ì§€ ì¶”ì²œ ì„¹ì…˜ ë‚´ìš© -->

                    <!-- Tesla -->
                    <div class="suggestion-item">
                        <div class="suggestion-user">
                            <img
                                src="https://cdn.pixabay.com/photo/2022/08/25/00/32/tesla-logo-7408969_640.png"
                                alt="teslamotors"
                                class="suggestion-avatar"
                            />
                            <div class="suggestion-info">
                                <div class="suggestion-username">teslamotors</div>
                                <div class="suggestion-meta">Tesla</div>
                            </div>
                        </div>
                        <button class="follow-button">íŒ”ë¡œìš°</button>
                    </div>

                    <!-- ì†í¥ë¯¼ -->
                    <div class="suggestion-item">
                        <div class="suggestion-user">
                            <img
                                src="https://i.namu.wiki/i/gV_pcWGwjszmR7I8ekwuH65PR34--6iOrKff4YkZceExXVnAHstASYyMsKZ4AKBMhTOqe2yWl9WC5KGOykjlKem5XQMqXkmnhCrbshqFknUa3dQ-HDI6kLdnWz-eGvXUOVL5wzeXzxnlL0sliLU_4w.webp"
                                alt="hm_son7"
                                class="suggestion-avatar"
                            />
                            <div class="suggestion-info">
                                <div class="suggestion-username">hm_son7</div>
                                <div class="suggestion-meta">Son HeungMin(ì†í¥ë¯¼)ğŸ‡°ğŸ‡·</div>
                            </div>
                        </div>
                        <button class="follow-button">íŒ”ë¡œìš°</button>
                    </div>

                    <!-- likelion -->
                    <div class="suggestion-item">
                        <div class="suggestion-user">
                            <img
                                src="https://img1.daumcdn.net/thumb/C500x500/?fname=http://t1.daumcdn.net/brunch/service/user/2YH6/image/7kmtv0190Fu60wySRrrBTt_z_Tc.png"
                                alt="likelion"
                                class="suggestion-avatar"
                            />
                            <div class="suggestion-info">
                                <div class="suggestion-username">likelion.official</div>
                                <div class="suggestion-meta">ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼</div>
                            </div>
                        </div>
                        <button class="follow-button">íŒ”ë¡œìš°</button>
                    </div>
                </div>

                <div class="footer">
                    ì†Œê°œ Â· ë„ì›€ë§ Â· í™ë³´ì„¼í„° Â· API Â· ì±„ìš© ì •ë³´
                    <br />
                    ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ Â· ì•½ê´€ Â· ìœ„ì¹˜ Â· ì–¸ì–´ Â· Meta Verified
                    <br /><br />
                    Â© 2025 INSTAGRAM FROM META
                </div>
            </aside>
        </div>

        <!-- first_modal -->
        <div id="first_modal" class="modal_overlay">
            <div class="modal_window">
                <div style="display: flex; flex-direction: row; justify-content: space-between">
                    <div style="width: 40px"></div>
                    <div>ìƒˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                    <!-- close iconì— class & id ì¶”ê°€ & style ì œê±° -->
                    <div class="close-button">
                        <span id="close_icon" class="material-symbols-outlined">close</span>
                    </div>
                </div>

                <div
                    class="img_upload_space"
                    style="border-top: solid 1px gray; width: 778px; height: 540px; margin-top: 10px"
                ></div>
            </div>
        </div>

        <!-- second_modal -->
        <div id="second_modal" class="modal_overlay">
            <div class="modal_window">
                <div style="display: flex; flex-direction: row; justify-content: space-between">
                    <div style="width: 40px"></div>
                    <div>ìƒˆ ê²Œì‹œë¬¼</div>
                    <!-- close iconì— class & id ì¶”ê°€ & style ì œê±° -->
                    <div class="close-button">
                        <span id="close_icon" class="material-symbols-outlined">close</span>
                    </div>
                </div>

                <div style="border-top: solid 1px gray; display: flex; flex-direction: row; margin-top: 10px">
                    <!-- ì™¼ìª½: ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
                    <div class="img_upload_space" style="width: 500px; height: 540px">
                        <div class="upload-guide" style="text-align: center; color: #8e8e8e">
                            <span class="material-symbols-outlined" style="font-size: 48px">add_photo_alternate</span>
                            <p>ì‚¬ì§„ì„ ì—¬ê¸°ì— ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”</p>
                        </div>
                    </div>
                    <!-- ì˜¤ë¥¸ìª½: ê¸€ ì‘ì„± ì˜ì—­ -->
                    <div style="border-left: solid 1px gray">
                        <div>
                            <textarea
                                id="input_feed_content"
                                class="form-control"
                                style="width: 276px; height: 400px"
                                rows="5"
                                placeholder="ë¬¸êµ¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                            ></textarea>
                        </div>
                        <button id="feed_create_button" type="button" class="btn btn-primary" style="width: 100%">
                            ê³µìœ í•˜ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- When add_box clicked -->
        <script>
            // ì „ì—­ ë³€ìˆ˜ë¡œ ì—…ë¡œë“œëœ íŒŒì¼ì„ ì €ì¥
            let uploadedFile;
            let files; // ë“œë¡­í•œ íŒŒì¼ì„ ë‹´ì„ ì „ì—­ ë³€ìˆ˜

            // ë§Œë“¤ê¸°(+) ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì°½ í‘œì‹œ
            $('#nav_bar_add_box').click(function (e) {
                e.preventDefault(); // í˜ì´ì§€ ì´ë™ ë°©ì§€
                $('#first_modal').css({
                    display: 'flex',
                });
                $(document.body).css({
                    overflow: 'hidden', // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
                });
            });

            // ëª¨ë‹¬ ì°½ì„ ë‹«ëŠ” í•¨ìˆ˜
            function closeModal() {
                $('.modal_overlay').css({
                    display: 'none',
                });
                $(document.body).css({
                    overflow: 'auto',
                });

                // ì…ë ¥ í•„ë“œì™€ ì´ë¯¸ì§€ ì´ˆê¸°í™”
                $('#input_feed_content').val('');
                $('.img_upload_space').css({
                    'background-image': 'none',
                    'background-color': '#fafafa',
                });
                $('.upload-guide').show();
                uploadedFile = null;
                files = null;
            }

            // close ë²„íŠ¼ ì´ë²¤íŠ¸
            $('.close-button').click(function () {
                closeModal();
            });

            // ê³µìœ í•˜ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            $('#feed_create_button').click(function () {
                // íŒŒì¼ì´ ì—†ì„ ê²½ìš° ì²´í¬
                if (!files || files.length === 0) {
                    alert('ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                let file = files[0];
                let content = $('#input_feed_content').val();

                // ì´ë¯¸ì§€ íŒŒì¼ ì²´í¬
                if (!file.type.match(/image.*/)) {
                    alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }

                let fd = new FormData();
                fd.append('file', file);
                fd.append('content', content);

                $.ajax({
                    url: '/content/upload',
                    data: fd,
                    method: 'POST',
                    processData: false,
                    contentType: false,
                    headers: { 'X-CSRFToken': csrftoken },
                    success: function (data) {
                        console.log('ì—…ë¡œë“œ ì„±ê³µ');
                        location.reload();
                    },
                    error: function (request, status, error) {
                        console.error('Error:', error);
                        alert('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    },
                });
            });

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ì„¤ì •
            $('.img_upload_space').on('dragover', dragOver).on('dragleave', dragOver).on('drop', uploadFiles);

            // ë“œë˜ê·¸ ì˜¤ë²„ ì´ë²¤íŠ¸ ì²˜ë¦¬
            function dragOver(e) {
                e.stopPropagation();
                e.preventDefault();

                if (e.type == 'dragover') {
                    $(e.target).css({
                        'background-color': 'rgba(0, 0, 0, 0.1)',
                        'outline-offset': '-20px',
                    });
                } else {
                    $(e.target).css({
                        'background-color': '#fafafa',
                        'outline-offset': '-10px',
                    });
                }
            }

            // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
            function uploadFiles(e) {
                e.stopPropagation();
                e.preventDefault();

                e.dataTransfer = e.originalEvent.dataTransfer;
                files = e.target.files || e.dataTransfer.files;

                // íŒŒì¼ ê°œìˆ˜ í™•ì¸
                if (files.length > 1) {
                    alert('í•˜ë‚˜ì˜ ì´ë¯¸ì§€ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }

                // ì´ë¯¸ì§€ íŒŒì¼ í™•ì¸
                if (files[0].type.match(/image.*/)) {
                    uploadedFile = files[0]; // íŒŒì¼ ì €ì¥
                    const imageUrl = window.URL.createObjectURL(files[0]);

                    // ì²« ë²ˆì§¸ ëª¨ë‹¬ì„ ìˆ¨ê¸°ê³  ë‘ ë²ˆì§¸ ëª¨ë‹¬ í‘œì‹œ
                    $('#first_modal').css({ display: 'none' });
                    $('#second_modal').css({ display: 'flex' });

                    // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì„¤ì •
                    $('.img_upload_space').css({
                        'background-image': `url(${imageUrl})`,
                        'background-size': 'contain',
                        'background-position': 'center',
                        'background-repeat': 'no-repeat',
                        'background-color': '#fafafa',
                        outline: 'none',
                    });

                    // ê°€ì´ë“œ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
                    $('.upload-guide').hide();
                } else {
                    alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }
            }

            // ëª¨ë‹¬ ì™¸ë¶€ ì˜ì—­ í´ë¦­ ì‹œ ë‹«ê¸°
            $('.modal_overlay').click(function (e) {
                // e.target === this (ì¦‰, ëª¨ë‹¬ ì˜ì—­ ë°”ê¹¥ìª½ì„ í´ë¦­í–ˆì„ ë•Œë§Œ ë‹«ê¸°)
                if (e.target === this) {
                    closeModal();
                }
            });

            // ëŒ“ê¸€ë‹¬ê¸° ê²Œì‹œ ë²„íŠ¼ í´ë¦­ ì‹œ ì§„í–‰ë˜ëŠ” ë¡œì§
            $('.upload_reply').click(function (event) {
                let feed_id = event.target.attributes.getNamedItem('feed_id').value;
                let reply_id = 'reply_' + feed_id;
                let reply_content = $('#' + reply_id).val();

                if (reply_content.length <= 0) {
                    alert('ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”');
                    return 0;
                }

                $.ajax({
                    url: '/content/reply',
                    data: {
                        feed_id: feed_id,
                        reply_content: reply_content,
                    },
                    method: 'POST',
                    headers: { 'X-CSRFToken': csrftoken },
                    success: function (data) {
                        console.log('ì„±ê³µ');
                        alert('ëŒ“ê¸€ ì„±ê³µ');
                        // ìƒˆ ëŒ“ê¸€ì„ ë™ì ìœ¼ë¡œ ì¶”ê°€ (ë¦¬ë¡œë“œ ì—†ì´ ì¶”ê°€í•˜ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ì²˜ëŸ¼)
                        $('#reply_list_' + feed_id).append(
                            "<div style='margin: 0 20px;text-align: left;font-size: 14px; margin-bottom:4px;'>" +
                                '<b>{{ user.nickname|default:user.username }}</b> ' +
                                reply_content +
                                '</div>'
                        );
                        // location.reload(); // ì „ì²´ ë¦¬ë¡œë“œë¥¼ í•˜ë ¤ë©´ ì£¼ì„ í•´ì œ
                    },
                    error: function (request, status, error) {
                        console.log('ì—ëŸ¬');
                    },
                    complete: function () {
                        console.log('ì™„ë£Œ');
                        $('#' + reply_id).val('');
                    },
                });
            });

            // ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            $(document).on('click', '.favorite', function () {
                let feed_id = $(this).attr('feed_id');
                let button = $(this);

                $.ajax({
                    url: '/content/like',
                    data: {
                        feed_id: feed_id,
                    },
                    method: 'POST',
                    headers: { 'X-CSRFToken': csrftoken },
                    success: function (data) {
                        let like_count = data.like_count;
                        $('#like_count_' + feed_id).text(like_count);

                        button.toggleClass('active');
                        if (button.hasClass('active')) {
                            button.text('favorite');
                        } else {
                            button.text('favorite_border');
                        }
                    },
                });
            });

            // ë¶ë§ˆí¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            $(document).on('click', '.bookmark', function () {
                let feed_id = $(this).attr('feed_id');
                let button = $(this);

                $.ajax({
                    url: '/content/bookmark',
                    data: {
                        feed_id: feed_id,
                    },
                    method: 'POST',
                    headers: { 'X-CSRFToken': csrftoken },
                    success: function (data) {
                        button.toggleClass('active');
                        if (button.hasClass('active')) {
                            button.text('bookmark');
                        } else {
                            button.text('bookmark_border');
                        }
                    },
                });
            });
        </script>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
